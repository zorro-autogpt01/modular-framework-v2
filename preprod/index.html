<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Web IDE Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1e1e1e;
            color: #cccccc;
            height: 100vh;
            overflow: hidden;
        }

        .ide-container {
            display: flex;
            height: 100vh;
        }

        .repo-sidebar {
            width: 260px;
            background: #1e1e1e;
            border-right: 1px solid #3e3e3e;
            display: flex;
            flex-direction: column;
            resize: horizontal;
            overflow: hidden;
        }

        .left-sidebar {
            width: 280px;
            background: #252526;
            border-right: 1px solid #3e3e3e;
            display: flex;
            flex-direction: column;
            resize: horizontal;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 10px;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e3e;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-tabs {
            display: flex;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e3e;
        }

        .sidebar-tab {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 11px;
            border-right: 1px solid #3e3e3e;
            transition: background 0.2s;
            flex: 1;
            text-align: center;
        }

        .sidebar-tab.active {
            background: #252526;
            color: #ffffff;
        }

        .sidebar-tab:hover:not(.active) {
            background: #383838;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
        }

        .connection-panel {
            padding: 12px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding: 8px;
            background: #1e1e1e;
            border-radius: 4px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ff6b6b;
        }

        .status-indicator.connected {
            background: #51cf66;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .input-group {
            margin-bottom: 10px;
        }

        .input-group label {
            display: block;
            margin-bottom: 4px;
            font-size: 11px;
            color: #9d9d9d;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 6px 8px;
            background: #3c3c3c;
            border: 1px solid #5a5a5a;
            border-radius: 2px;
            color: #cccccc;
            font-size: 12px;
        }

        .btn {
            padding: 6px 12px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 2px;
            cursor: pointer;
            font-size: 11px;
            transition: background 0.2s;
            width: 100%;
            margin-bottom: 6px;
        }

        .btn:hover {
            background: #1177bb;
        }

        .btn.secondary {
            background: #5a5a5a;
        }

        .btn.danger {
            background: #e74c3c;
        }

        .btn.success {
            background: #27ae60;
        }

        .btn.small {
            padding: 4px 8px;
            font-size: 10px;
        }

        .file-tree {
            padding: 8px 0;
        }

        .file-item, .folder-item {
            padding: 4px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 12px;
            transition: background 0.1s;
            position: relative;
        }

        .file-item:hover, .folder-item:hover {
            background: #2a2d2e;
        }

        .file-item.active {
            background: #094771;
            color: #ffffff;
        }

        .file-item.modified::after {
            content: '‚óè';
            position: absolute;
            right: 8px;
            color: #ff9800;
        }

        .folder-children {
            margin-left: 16px;
        }

        .folder-children.hidden {
            display: none;
        }

        .repo-explorer {
            padding: 12px;
        }

        .repo-section {
            margin-bottom: 16px;
            border: 1px solid #3e3e3e;
            border-radius: 4px;
            background: #252526;
        }

        .repo-section-header {
            padding: 8px 12px;
            background: #2d2d30;
            font-weight: bold;
            font-size: 11px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .repo-section-content {
            padding: 12px;
        }

        .repo-section-content.collapsed {
            display: none;
        }

        .branch-list {
            max-height: 120px;
            overflow-y: auto;
        }

        .branch-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 4px 8px;
            margin: 2px 0;
            border-radius: 2px;
            font-size: 11px;
            cursor: pointer;
        }

        .branch-item:hover {
            background: #2a2d2e;
        }

        .branch-item.current {
            background: #094771;
            color: #ffffff;
        }

        .commit-list {
            max-height: 150px;
            overflow-y: auto;
        }

        .commit-item {
            padding: 6px 8px;
            margin: 2px 0;
            border-left: 3px solid #0e639c;
            font-size: 11px;
            background: #1e1e1e;
            border-radius: 2px;
            cursor: pointer;
        }

        .commit-item:hover {
            background: #2a2d2e;
        }

        .commit-hash {
            color: #ff9800;
            font-family: monospace;
        }

        .docker-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 8px;
            margin: 2px 0;
            background: #1e1e1e;
            border-radius: 2px;
            font-size: 11px;
        }

        .container-status {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .container-status.running {
            background: #27ae60;
        }

        .container-status.stopped {
            background: #e74c3c;
        }

        .database-connection {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 8px;
            margin: 2px 0;
            background: #1e1e1e;
            border-radius: 2px;
            font-size: 11px;
            cursor: pointer;
        }

        .database-connection:hover {
            background: #2a2d2e;
        }

        .db-status {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .db-status.connected {
            background: #27ae60;
        }

        .db-status.disconnected {
            background: #e74c3c;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .toolbar {
            background: #2d2d30;
            padding: 6px 12px;
            border-bottom: 1px solid #3e3e3e;
            display: flex;
            gap: 6px;
            align-items: center;
            flex-wrap: wrap;
        }

        .toolbar-group {
            display: flex;
            gap: 4px;
            align-items: center;
            border-right: 1px solid #5a5a5a;
            padding-right: 8px;
            margin-right: 8px;
        }

        .toolbar-group:last-child {
            border-right: none;
            margin-right: 0;
        }

        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .tabs-container {
            background: #2d2d30;
            border-bottom: 1px solid #3e3e3e;
            display: flex;
            overflow-x: auto;
            min-height: 35px;
        }

        .tab {
            padding: 8px 16px;
            background: #2d2d30;
            border-right: 1px solid #3e3e3e;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 12px;
            white-space: nowrap;
            position: relative;
            min-width: 120px;
        }

        .tab.active {
            background: #1e1e1e;
            color: #ffffff;
        }

        .tab-close {
            margin-left: 8px;
            opacity: 0.6;
            cursor: pointer;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 2px;
        }

        .tab-close:hover {
            opacity: 1;
            background: #e81123;
        }

        .editor-container {
            flex: 1;
            display: flex;
        }

        .editor-area {
            flex: 1;
            position: relative;
        }

        .bottom-panel {
            height: 200px;
            background: #252526;
            border-top: 1px solid #3e3e3e;
            display: flex;
            flex-direction: column;
            resize: vertical;
            overflow: hidden;
        }

        .bottom-panel.hidden {
            height: 0;
            min-height: 0;
        }

        .bottom-tabs {
            display: flex;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e3e;
        }

        .bottom-tab {
            padding: 6px 12px;
            cursor: pointer;
            font-size: 11px;
            border-right: 1px solid #3e3e3e;
        }

        .bottom-tab.active {
            background: #252526;
        }

        .bottom-content {
            flex: 1;
            overflow: hidden;
        }

        .terminal {
            width: 100%;
            height: 100%;
            background: #1e1e1e;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 8px;
            overflow-y: auto;
            font-size: 11px;
            line-height: 1.4;
        }

        .terminal-input {
            display: flex;
            align-items: center;
            margin-top: 8px;
        }

        .terminal-prompt {
            color: #00ff00;
            margin-right: 8px;
        }

        .terminal-command {
            flex: 1;
            background: transparent;
            border: none;
            color: #00ff00;
            font-family: inherit;
            font-size: inherit;
            outline: none;
        }

        .database-browser {
            padding: 8px;
            height: 100%;
            overflow-y: auto;
        }

        .db-query-editor {
            width: 100%;
            height: 60px;
            background: #3c3c3c;
            border: 1px solid #5a5a5a;
            color: #cccccc;
            padding: 8px;
            border-radius: 2px;
            resize: vertical;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            margin-bottom: 8px;
        }

        .db-results {
            background: #1e1e1e;
            border: 1px solid #3e3e3e;
            border-radius: 2px;
            overflow: auto;
            max-height: 200px;
        }

        .db-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }

        .db-table th, .db-table td {
            padding: 4px 8px;
            text-align: left;
            border-bottom: 1px solid #3e3e3e;
        }

        .db-table th {
            background: #2d2d30;
            font-weight: bold;
        }

        .status-bar {
            background: #007acc;
            color: white;
            padding: 4px 12px;
            font-size: 11px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-left, .status-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: #252526;
            border: 1px solid #3e3e3e;
            border-radius: 4px;
            padding: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            border-bottom: 1px solid #3e3e3e;
            padding-bottom: 8px;
        }

        .modal-close {
            cursor: pointer;
            font-size: 18px;
            opacity: 0.7;
        }

        .modal-close:hover {
            opacity: 1;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 12px 16px;
            border-radius: 4px;
            z-index: 1001;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            max-width: 300px;
            cursor: pointer;
        }

        .notification.error {
            background: #e74c3c;
        }

        .notification.warning {
            background: #f39c12;
        }

        .notification.info {
            background: #3498db;
        }

        .hidden { display: none !important; }

        #monaco-editor, #monaco-diff {
            height: 100%;
            width: 100%;
        }

        .workspace-indicator {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #094771;
            color: white;
            padding: 2px 6px;
            border-radius: 2px;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div class="ide-container">
        <!-- Repository Sidebar -->
        <div class="repo-sidebar">
            <div class="sidebar-header">
                <span>REPOSITORY</span>
                <button class="btn small" onclick="openGitHubModal()">üîó</button>
            </div>

            <div class="sidebar-content">
                <div class="repo-explorer">
                    <!-- Git Section -->
                    <div class="repo-section">
                        <div class="repo-section-header" onclick="toggleRepoSection('git')">
                            <span>üåø Git Repository</span>
                            <span id="gitToggle">‚ñº</span>
                        </div>
                        <div class="repo-section-content" id="gitSection">
                            <div class="input-group">
                                <label>Current Branch</label>
                                <select id="branchSelector" style="font-size: 11px;">
                                    <option value="main">main</option>
                                    <option value="develop">develop</option>
                                    <option value="feature/auth">feature/auth</option>
                                </select>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-bottom: 8px;">
                                <button class="btn small" onclick="gitPull()">Pull</button>
                                <button class="btn small" onclick="gitFetch()">Fetch</button>
                                <button class="btn small secondary" onclick="gitStash()">Stash</button>
                                <button class="btn small secondary" onclick="createBranch()">Branch</button>
                            </div>

                            <div class="input-group">
                                <textarea class="db-query-editor" id="commitMessage" placeholder="Commit message..." style="height: 40px; font-size: 11px;"></textarea>
                            </div>

                            <button class="btn success small" onclick="quickCommitPush()">üí´ Commit & Push</button>

                            <div style="margin-top: 12px;">
                                <div style="font-size: 10px; color: #9d9d9d; margin-bottom: 4px;">BRANCHES</div>
                                <div class="branch-list" id="branchList">
                                    <div class="branch-item current">
                                        <span>üåø main</span>
                                        <span>*</span>
                                    </div>
                                    <div class="branch-item">
                                        <span>üåø develop</span>
                                        <span></span>
                                    </div>
                                    <div class="branch-item">
                                        <span>üåø feature/auth</span>
                                        <span></span>
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top: 12px;">
                                <div style="font-size: 10px; color: #9d9d9d; margin-bottom: 4px;">RECENT COMMITS</div>
                                <div class="commit-list" id="commitList">
                                    <div class="commit-item">
                                        <div><span class="commit-hash">a1b2c3d</span> Add authentication</div>
                                        <div style="font-size: 10px; color: #9d9d9d;">2 hours ago - John Doe</div>
                                    </div>
                                    <div class="commit-item">
                                        <div><span class="commit-hash">e4f5g6h</span> Fix navbar styling</div>
                                        <div style="font-size: 10px; color: #9d9d9d;">1 day ago - Jane Smith</div>
                                    </div>
                                    <div class="commit-item">
                                        <div><span class="commit-hash">i7j8k9l</span> Initial commit</div>
                                        <div style="font-size: 10px; color: #9d9d9d;">3 days ago - John Doe</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Docker Section -->
                    <div class="repo-section">
                        <div class="repo-section-header" onclick="toggleRepoSection('docker')">
                            <span>üê≥ Docker</span>
                            <span id="dockerToggle">‚ñº</span>
                        </div>
                        <div class="repo-section-content" id="dockerSection">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-bottom: 8px;">
                                <button class="btn small" onclick="dockerBuild()">Build</button>
                                <button class="btn small success" onclick="dockerRun()">Run</button>
                                <button class="btn small secondary" onclick="dockerPs()">List</button>
                                <button class="btn small danger" onclick="dockerStop()">Stop All</button>
                            </div>

                            <div style="margin-top: 8px;">
                                <div style="font-size: 10px; color: #9d9d9d; margin-bottom: 4px;">CONTAINERS</div>
                                <div id="dockerContainers">
                                    <div class="docker-container">
                                        <div style="display: flex; align-items: center;">
                                            <div class="container-status running"></div>
                                            <span>frontend</span>
                                        </div>
                                        <span style="color: #27ae60;">Running</span>
                                    </div>
                                    <div class="docker-container">
                                        <div style="display: flex; align-items: center;">
                                            <div class="container-status running"></div>
                                            <span>backend</span>
                                        </div>
                                        <span style="color: #27ae60;">Running</span>
                                    </div>
                                    <div class="docker-container">
                                        <div style="display: flex; align-items: center;">
                                            <div class="container-status stopped"></div>
                                            <span>postgres</span>
                                        </div>
                                        <span style="color: #e74c3c;">Stopped</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Database Section -->
                    <div class="repo-section">
                        <div class="repo-section-header" onclick="toggleRepoSection('database')">
                            <span>üóÑÔ∏è Database</span>
                            <span id="databaseToggle">‚ñº</span>
                        </div>
                        <div class="repo-section-content" id="databaseSection">
                            <button class="btn small" onclick="addDatabaseConnection()">‚ûï Add Connection</button>
                            
                            <div style="margin-top: 8px;">
                                <div style="font-size: 10px; color: #9d9d9d; margin-bottom: 4px;">CONNECTIONS</div>
                                <div id="databaseConnections">
                                    <div class="database-connection" onclick="connectDatabase('postgres_dev')">
                                        <div style="display: flex; align-items: center;">
                                            <div class="db-status connected"></div>
                                            <span>PostgreSQL Dev</span>
                                        </div>
                                        <span style="color: #27ae60;">‚óè</span>
                                    </div>
                                    <div class="database-connection" onclick="connectDatabase('mysql_prod')">
                                        <div style="display: flex; align-items: center;">
                                            <div class="db-status disconnected"></div>
                                            <span>MySQL Prod</span>
                                        </div>
                                        <span style="color: #e74c3c;">‚óè</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- File Explorer Sidebar -->
        <div class="left-sidebar">
            <div class="sidebar-header">
                <span>FILE EXPLORER</span>
                <div style="display: flex; gap: 4px;">
                    <button class="btn small secondary" onclick="refreshFileTree()">‚Üª</button>
                    <button class="btn small" onclick="newFile()">üìÑ</button>
                </div>
            </div>

            <div class="sidebar-tabs">
                <div class="sidebar-tab active" data-panel="explorer">üìÅ</div>
                <div class="sidebar-tab" data-panel="search">üîç</div>
                <div class="sidebar-tab" data-panel="ssh">üîó</div>
            </div>

            <div class="sidebar-content">
                <!-- File Explorer -->
                <div id="explorer-panel" class="sidebar-panel">
                    <div class="workspace-indicator" id="workspaceIndicator">Local</div>
                    <div class="file-tree" id="fileTree">
                        <div style="padding: 20px; text-align: center; color: #9d9d9d;">
                            Loading files...
                        </div>
                    </div>
                </div>

                <!-- Search Panel -->
                <div id="search-panel" class="sidebar-panel hidden">
                    <div style="padding: 12px;">
                        <input type="text" style="width: 100%; padding: 6px; background: #3c3c3c; border: 1px solid #5a5a5a; color: #cccccc; border-radius: 2px; font-size: 12px;" placeholder="Search in files..." id="searchInput">
                        <div style="margin-top: 8px; max-height: 300px; overflow-y: auto;" id="searchResults"></div>
                    </div>
                </div>

                <!-- SSH Connection Panel -->
                <div id="ssh-panel" class="sidebar-panel hidden">
                    <div class="connection-panel">
                        <div class="connection-status">
                            <div class="status-indicator" id="connectionStatus"></div>
                            <span id="connectionText">Disconnected</span>
                        </div>

                        <div class="input-group">
                            <label>Host</label>
                            <input type="text" id="sshHost" placeholder="192.168.1.100" value="dev-server.local">
                        </div>

                        <div class="input-group">
                            <label>Port</label>
                            <input type="number" id="sshPort" value="22">
                        </div>

                        <div class="input-group">
                            <label>Username</label>
                            <input type="text" id="sshUsername" placeholder="user" value="developer">
                        </div>

                        <div class="input-group">
                            <label>Authentication</label>
                            <select id="authMethod">
                                <option value="key">SSH Key</option>
                                <option value="password">Password</option>
                            </select>
                        </div>

                        <div class="input-group hidden" id="passwordGroup">
                            <label>Password</label>
                            <input type="password" id="sshPassword">
                        </div>

                        <div class="input-group">
                            <label>Remote Path</label>
                            <input type="text" id="remotePath" placeholder="/home/user/projects" value="/var/www/html">
                        </div>

                        <button class="btn" onclick="connectSSH()" id="connectBtn">üîó Connect SSH</button>
                        <button class="btn danger hidden" onclick="disconnectSSH()" id="disconnectBtn">Disconnect</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Toolbar -->
            <div class="toolbar">
                <div class="toolbar-group">
                    <button class="btn small" onclick="saveCurrentFile()">üíæ</button>
                    <button class="btn small secondary" onclick="saveAllFiles()">üíæ*</button>
                    <button class="btn small secondary" onclick="formatDocument()">üé®</button>
                </div>

                <div class="toolbar-group">
                    <button class="btn small secondary" onclick="newFile()">üìÑ</button>
                    <button class="btn small secondary" onclick="newFolder()">üìÅ</button>
                    <button class="btn small secondary" onclick="uploadFile()">‚¨Ü</button>
                </div>

                <div class="toolbar-group">
                    <button class="btn small secondary" onclick="showDiff()">üìã</button>
                    <button class="btn small secondary" onclick="toggleMinimap()">üó∫</button>
                    <button class="btn small secondary" onclick="toggleTerminal()">üíª</button>
                </div>

                <div class="toolbar-group">
                    <button class="btn small" onclick="runProject()">‚ñ∂</button>
                    <button class="btn small secondary" onclick="buildProject()">üî®</button>
                    <button class="btn small secondary" onclick="deployProject()">üöÄ</button>
                </div>
            </div>

            <div class="content-area">
                <!-- Tabs -->
                <div class="tabs-container" id="tabsContainer">
                    <!-- Tabs will be populated by JavaScript -->
                </div>

                <!-- Editor Area -->
                <div class="editor-container">
                    <div class="editor-area">
                        <div id="monaco-editor"></div>
                        <div id="monaco-diff" class="hidden"></div>
                    </div>
                </div>

                <!-- Bottom Panel -->
                <div class="bottom-panel" id="bottomPanel">
                    <div class="bottom-tabs">
                        <div class="bottom-tab active" data-panel="terminal">Terminal</div>
                        <div class="bottom-tab" data-panel="problems">Problems (0)</div>
                        <div class="bottom-tab" data-panel="output">Output</div>
                        <div class="bottom-tab" data-panel="database">Database</div>
                        <div class="bottom-tab" data-panel="docker">Docker Logs</div>
                    </div>

                    <div class="bottom-content">
                        <div id="terminal-panel" class="bottom-content-panel">
                            <div class="terminal" id="terminal">
                                <div>üöÄ Advanced Web IDE Pro - Terminal</div>
                                <div>Connected to: <span id="terminalHost">localhost</span></div>
                                <div>Type 'help' for available commands</div>
                                <div class="terminal-input">
                                    <span class="terminal-prompt">$</span>
                                    <input type="text" class="terminal-command" id="terminalInput" placeholder="Enter command...">
                                </div>
                            </div>
                        </div>

                        <div id="problems-panel" class="bottom-content-panel hidden">
                            <div style="padding: 8px; height: 100%; overflow-y: auto;" id="problemsList">
                                <div style="padding: 16px; text-align: center; color: #9d9d9d; font-size: 12px;">No problems found</div>
                            </div>
                        </div>

                        <div id="output-panel" class="bottom-content-panel hidden">
                            <div class="terminal" id="outputContent">
                                <div>Build Output Console</div>
                            </div>
                        </div>

                        <div id="database-panel" class="bottom-content-panel hidden">
                            <div class="database-browser">
                                <div style="margin-bottom: 8px;">
                                    <select id="dbConnectionSelect" style="width: 150px; margin-right: 8px;">
                                        <option value="postgres_dev">PostgreSQL Dev</option>
                                        <option value="mysql_prod">MySQL Prod</option>
                                    </select>
                                    <button class="btn small" onclick="executeQuery()">‚ñ∂ Execute</button>
                                    <button class="btn small secondary" onclick="clearQuery()">Clear</button>
                                </div>
                                <textarea class="db-query-editor" id="sqlQuery" placeholder="SELECT * FROM users LIMIT 10;">SELECT * FROM users WHERE created_at > '2024-01-01' ORDER BY id DESC LIMIT 50;</textarea>
                                <div class="db-results" id="queryResults">
                                    <table class="db-table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Created</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>1</td>
                                                <td>John Doe</td>
                                                <td>john@example.com</td>
                                                <td>2024-01-15</td>
                                            </tr>
                                            <tr>
                                                <td>2</td>
                                                <td>Jane Smith</td>
                                                <td>jane@example.com</td>
                                                <td>2024-01-14</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div id="docker-panel" class="bottom-content-panel hidden">
                            <div class="terminal" id="dockerLogs">
                                <div>üê≥ Docker Container Logs</div>
                                <div>[frontend] Starting development server...</div>
                                <div>[frontend] Server running on http://localhost:3000</div>
                                <div>[backend] API server started on port 3001</div>
                                <div>[postgres] Database ready for connections</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Bar -->
            <div class="status-bar">
                <div class="status-left">
                    <span id="statusMessage">Ready</span>
                    <span id="connectionInfo">üîó Local</span>
                    <span id="gitInfo">üåø main</span>
                    <span id="dockerInfo">üê≥ 3 containers</span>
                </div>
                <div class="status-right">
                    <span id="cursorPosition">Line 1, Column 1</span>
                    <span id="languageMode">Markdown</span>
                    <span id="encodingInfo">UTF-8</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="githubModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üêô GitHub Integration</h3>
                <span class="modal-close" onclick="closeGitHubModal()">√ó</span>
            </div>
            
            <div class="input-group">
                <label>GitHub Token</label>
                <input type="password" id="githubToken" placeholder="ghp_...">
            </div>

            <div class="input-group">
                <label>Repository URL</label>
                <input type="text" id="repoUrl" placeholder="https://github.com/user/repo.git">
            </div>

            <div class="input-group">
                <label>Action</label>
                <select id="gitAction">
                    <option value="clone">Clone Repository</option>
                    <option value="init">Initialize & Connect</option>
                    <option value="connect">Connect Existing</option>
                </select>
            </div>

            <div style="display: flex; gap: 8px; margin-top: 16px;">
                <button class="btn" onclick="executeGitHubAction()">Execute</button>
                <button class="btn secondary" onclick="closeGitHubModal()">Cancel</button>
            </div>
        </div>
    </div>

    <div id="databaseModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üóÑÔ∏è Add Database Connection</h3>
                <span class="modal-close" onclick="closeDatabaseModal()">√ó</span>
            </div>
            
            <div class="input-group">
                <label>Database Type</label>
                <select id="dbType">
                    <option value="postgresql">PostgreSQL</option>
                    <option value="mysql">MySQL</option>
                    <option value="mongodb">MongoDB</option>
                    <option value="redis">Redis</option>
                    <option value="sqlite">SQLite</option>
                </select>
            </div>

            <div class="input-group">
                <label>Connection Name</label>
                <input type="text" id="dbName" placeholder="My Database">
            </div>

            <div class="input-group">
                <label>Host</label>
                <input type="text" id="dbHost" placeholder="localhost">
            </div>

            <div class="input-group">
                <label>Port</label>
                <input type="number" id="dbPort" placeholder="5432">
            </div>

            <div class="input-group">
                <label>Database</label>
                <input type="text" id="dbDatabase" placeholder="myapp">
            </div>

            <div class="input-group">
                <label>Username</label>
                <input type="text" id="dbUsername" placeholder="user">
            </div>

            <div class="input-group">
                <label>Password</label>
                <input type="password" id="dbPassword" placeholder="password">
            </div>

            <div style="display: flex; gap: 8px; margin-top: 16px;">
                <button class="btn" onclick="testDatabaseConnection()">Test Connection</button>
                <button class="btn success" onclick="saveDatabaseConnection()">Save</button>
                <button class="btn secondary" onclick="closeDatabaseModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <script>
        require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' } });

        // Global State
        let editor = null;
        let diffEditor = null;
        let openFiles = new Map();
        let activeFile = null;
        let isConnected = false;
        let currentWorkspace = 'local';
        let gitRepository = { branch: 'main', url: 'https://github.com/user/repo.git' };

        // Sample file tree
        let fileTree = {
            'src': {
                type: 'folder',
                children: {
                    'components': {
                        type: 'folder',
                        children: {
                            'App.tsx': { type: 'file', content: 'import React from \'react\';\n\nfunction App() {\n  return (\n    <div className="App">\n      <h1>Advanced Web IDE Pro</h1>\n      <p>A comprehensive development environment</p>\n    </div>\n  );\n}\n\nexport default App;' },
                            'Header.tsx': { type: 'file', content: 'import React from \'react\';\n\nconst Header: React.FC = () => {\n  return (\n    <header className="header">\n      <h1>My Application</h1>\n      <nav>\n        <a href="/">Home</a>\n        <a href="/about">About</a>\n      </nav>\n    </header>\n  );\n};\n\nexport default Header;' }
                        }
                    },
                    'utils': {
                        type: 'folder',
                        children: {
                            'helpers.ts': { type: 'file', content: 'export const formatDate = (date: Date): string => {\n  return new Intl.DateTimeFormat(\'en-US\').format(date);\n};\n\nexport const debounce = <T extends (...args: any[]) => any>(\n  func: T,\n  wait: number\n): ((...args: Parameters<T>) => void) => {\n  let timeout: NodeJS.Timeout;\n  return (...args: Parameters<T>) => {\n    clearTimeout(timeout);\n    timeout = setTimeout(() => func(...args), wait);\n  };\n};' }
                        }
                    },
                    'index.tsx': { type: 'file', content: 'import React from \'react\';\nimport ReactDOM from \'react-dom/client\';\nimport App from \'./components/App\';\nimport \'./styles.css\';\n\nconst root = ReactDOM.createRoot(\n  document.getElementById(\'root\') as HTMLElement\n);\n\nroot.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);' },
                    'styles.css': { type: 'file', content: '/* Global styles */\nbody {\n  margin: 0;\n  font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', \'Roboto\', sans-serif;\n  background-color: #f5f5f5;\n}\n\n.App {\n  text-align: center;\n  padding: 40px 20px;\n}\n\nh1 {\n  color: #333;\n  margin-bottom: 20px;\n}' }
                }
            },
            'package.json': { type: 'file', content: '{\n  "name": "advanced-web-ide-demo",\n  "version": "1.0.0",\n  "description": "Demo project for Advanced Web IDE Pro",\n  "main": "src/index.tsx",\n  "dependencies": {\n    "react": "^18.2.0",\n    "react-dom": "^18.2.0",\n    "typescript": "^4.9.0"\n  },\n  "scripts": {\n    "start": "react-scripts start",\n    "build": "react-scripts build",\n    "test": "react-scripts test"\n  }\n}' },
            'README.md': { type: 'file', content: '# Advanced Web IDE Pro\n\nA comprehensive, cloud-based integrated development environment with advanced features for modern web development.\n\n## Features\n\n- **Multi-file Editor**: Monaco Editor with IntelliSense\n- **SSH Connectivity**: Connect to remote servers\n- **Git Integration**: Complete version control\n- **Docker Support**: Container management\n- **Database Browser**: Multi-database support\n- **Built-in Terminal**: Execute commands\n\n## Quick Start\n\n1. Connect to a remote server via SSH\n2. Clone a repository from GitHub\n3. Start editing files with full IDE features\n4. Build and deploy your application\n\n## Keyboard Shortcuts\n\n- `Ctrl+S` - Save file\n- `Ctrl+N` - New file\n- `Ctrl+`` - Toggle terminal\n- `Ctrl+Shift+F` - Global search\n\nEnjoy coding! üöÄ' }
        };

        require(['vs/editor/editor.main'], function () {
            initializeEditor();
            initializePanels();
            setTimeout(() => {
                renderFileTree();
                openFile('README.md');
                updateGitStatus();
            }, 500);
        });

        function initializeEditor() {
            editor = monaco.editor.create(document.getElementById('monaco-editor'), {
                value: '',
                language: 'markdown',
                theme: 'vs-dark',
                automaticLayout: true,
                minimap: { enabled: true },
                scrollBeyondLastLine: false,
                fontSize: 14,
                lineNumbers: 'on',
                wordWrap: 'on',
                cursorBlinking: 'blink',
                quickSuggestions: true,
                suggestOnTriggerCharacters: true,
                formatOnPaste: true,
                formatOnType: true
            });

            diffEditor = monaco.editor.createDiffEditor(document.getElementById('monaco-diff'), {
                theme: 'vs-dark',
                automaticLayout: true,
                readOnly: false
            });

            editor.onDidChangeCursorPosition((e) => {
                document.getElementById('cursorPosition').textContent = 
                    `Line ${e.position.lineNumber}, Column ${e.position.column}`;
            });

            editor.onDidChangeModelContent(() => {
                if (activeFile) {
                    markFileAsModified(activeFile);
                }
            });
        }

        function initializePanels() {
            // Initialize sidebar tabs
            document.querySelectorAll('.sidebar-tab').forEach(tab => {
                tab.addEventListener('click', () => switchSidebarPanel(tab.dataset.panel));
            });

            // Initialize bottom panel tabs
            document.querySelectorAll('.bottom-tab').forEach(tab => {
                tab.addEventListener('click', () => switchBottomPanel(tab.dataset.panel));
            });

            // Terminal input handler
            document.getElementById('terminalInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    executeTerminalCommand(e.target.value);
                    e.target.value = '';
                }
            });

            // Search input handler
            document.getElementById('searchInput').addEventListener('input', (e) => {
                searchInFiles(e.target.value);
            });

            // Auth method change
            document.getElementById('authMethod').addEventListener('change', (e) => {
                const passwordGroup = document.getElementById('passwordGroup');
                passwordGroup.style.display = e.target.value === 'password' ? 'block' : 'none';
            });
        }

        // API Functions
        const AdvancedAPI = {
            async connectSSH(config) {
                showNotification('üîó Connecting to SSH...', 'info');
                
                return new Promise(resolve => {
                    setTimeout(() => {
                        isConnected = true;
                        currentWorkspace = 'remote';
                        
                        updateConnectionStatus(true, config.host);
                        updateWorkspaceIndicator('Remote: ' + config.host);
                        
                        // Load remote file tree
                        loadRemoteFileTree();
                        
                        document.getElementById('terminalHost').textContent = config.host;
                        addToTerminal(`Connected to ${config.host}`);
                        
                        showNotification(`‚úÖ Connected to ${config.host}`, 'success');
                        resolve({ success: true, host: config.host });
                    }, 2000);
                });
            },

            async disconnectSSH() {
                return new Promise(resolve => {
                    setTimeout(() => {
                        isConnected = false;
                        currentWorkspace = 'local';
                        
                        updateConnectionStatus(false);
                        updateWorkspaceIndicator('Local');
                        
                        // Restore local file tree
                        renderFileTree();
                        
                        document.getElementById('terminalHost').textContent = 'localhost';
                        addToTerminal('Disconnected from remote server');
                        
                        showNotification('üîå Disconnected from SSH', 'info');
                        resolve({ success: true });
                    }, 500);
                });
            },

            async executeGitCommand(command) {
                return new Promise(resolve => {
                    setTimeout(() => {
                        addToTerminal(`$ ${command}`);
                        const output = simulateGitOutput(command);
                        addToTerminal(output);
                        resolve({ output, success: true });
                    }, 1000);
                });
            },

            async executeRemoteCommand(command) {
                return new Promise(resolve => {
                    setTimeout(() => {
                        const output = simulateCommandOutput(command);
                        resolve({ output, exitCode: 0 });
                    }, 500);
                });
            }
        };

        // UI Functions
        function switchSidebarPanel(panelName) {
            document.querySelectorAll('.sidebar-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.sidebar-panel').forEach(panel => {
                panel.classList.add('hidden');
            });

            document.querySelector(`[data-panel="${panelName}"]`).classList.add('active');
            document.getElementById(`${panelName}-panel`).classList.remove('hidden');
        }

        function switchBottomPanel(panelName) {
            document.querySelectorAll('.bottom-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.bottom-content-panel').forEach(panel => {
                panel.classList.add('hidden');
            });

            document.querySelector(`[data-panel="${panelName}"]`).classList.add('active');
            document.getElementById(`${panelName}-panel`).classList.remove('hidden');
        }

        function updateWorkspaceIndicator(text) {
            document.getElementById('workspaceIndicator').textContent = text;
        }

        function loadRemoteFileTree() {
            // Simulate remote file structure
            fileTree = {
                'var': {
                    type: 'folder',
                    children: {
                        'www': {
                            type: 'folder',
                            children: {
                                'html': {
                                    type: 'folder',
                                    children: {
                                        'index.php': { type: 'file', content: '<?php\necho "Hello from remote server!";\nphpinfo();\n?>' },
                                        'config.php': { type: 'file', content: '<?php\ndefine(\'DB_HOST\', \'localhost\');\ndefine(\'DB_NAME\', \'production_db\');\n?>' }
                                    }
                                }
                            }
                        }
                    }
                },
                'home': {
                    type: 'folder',
                    children: {
                        'developer': {
                            type: 'folder',
                            children: {
                                'projects': {
                                    type: 'folder',
                                    children: {
                                        'my-app': {
                                            type: 'folder',
                                            children: {
                                                'app.js': { type: 'file', content: 'const express = require(\'express\');\nconst app = express();\n\napp.get(\'/\', (req, res) => {\n  res.send(\'Hello from remote server!\');\n});\n\napp.listen(3000);' }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            };
            renderFileTree();
            showNotification('üìÇ Remote files loaded', 'success');
        }

        // SSH Functions
        async function connectSSH() {
            const config = {
                host: document.getElementById('sshHost').value,
                port: document.getElementById('sshPort').value,
                username: document.getElementById('sshUsername').value,
                authMethod: document.getElementById('authMethod').value,
                password: document.getElementById('sshPassword').value,
                remotePath: document.getElementById('remotePath').value
            };

            if (!config.host || !config.username) {
                showNotification('‚ùå Please fill in required fields', 'error');
                return;
            }

            try {
                await AdvancedAPI.connectSSH(config);
                document.getElementById('connectBtn').classList.add('hidden');
                document.getElementById('disconnectBtn').classList.remove('hidden');
            } catch (error) {
                showNotification('‚ùå Connection failed: ' + error.message, 'error');
            }
        }

        async function disconnectSSH() {
            await AdvancedAPI.disconnectSSH();
            document.getElementById('connectBtn').classList.remove('hidden');
            document.getElementById('disconnectBtn').classList.add('hidden');
        }

        function updateConnectionStatus(connected, host = '') {
            const indicator = document.getElementById('connectionStatus');
            const text = document.getElementById('connectionText');
            const info = document.getElementById('connectionInfo');

            if (connected) {
                indicator.classList.add('connected');
                text.textContent = `Connected to ${host}`;
                info.textContent = `üîó ${host}`;
            } else {
                indicator.classList.remove('connected');
                text.textContent = 'Disconnected';
                info.textContent = 'üîó Local';
            }
        }

        function refreshFileTree() {
            renderFileTree();
            showNotification('üìÇ File tree refreshed', 'info');
        }

        // Repository Functions
        function toggleRepoSection(sectionName) {
            const content = document.getElementById(`${sectionName}Section`);
            const toggle = document.getElementById(`${sectionName}Toggle`);
            
            content.classList.toggle('collapsed');
            toggle.textContent = content.classList.contains('collapsed') ? '‚ñ∂' : '‚ñº';
        }

        // Git Functions
        async function gitPull() {
            await AdvancedAPI.executeGitCommand('git pull origin main');
            updateGitStatus();
        }

        async function gitFetch() {
            await AdvancedAPI.executeGitCommand('git fetch');
            updateGitStatus();
        }

        async function gitStash() {
            await AdvancedAPI.executeGitCommand('git stash');
            updateGitStatus();
        }

        async function createBranch() {
            const branchName = prompt('Enter new branch name:');
            if (branchName) {
                await AdvancedAPI.executeGitCommand(`git checkout -b ${branchName}`);
                updateGitStatus();
            }
        }

        async function quickCommitPush() {
            const message = document.getElementById('commitMessage').value;
            if (!message) {
                showNotification('‚ö†Ô∏è Please enter a commit message', 'warning');
                return;
            }
            
            showNotification('üí´ Executing quick commit & push...', 'info');
            await AdvancedAPI.executeGitCommand('git add .');
            await AdvancedAPI.executeGitCommand(`git commit -m "${message}"`);
            await AdvancedAPI.executeGitCommand('git push origin main');
            document.getElementById('commitMessage').value = '';
            updateGitStatus();
        }

        function updateGitStatus() {
            const gitInfo = document.getElementById('gitInfo');
            gitInfo.textContent = 'üåø main';
        }

        // Docker Functions
        async function dockerBuild() {
            switchBottomPanel('docker');
            document.getElementById('bottomPanel').classList.remove('hidden');
            addToDockerLogs('üê≥ Building Docker image...');
        }

        async function dockerRun() {
            switchBottomPanel('docker');
            document.getElementById('bottomPanel').classList.remove('hidden');
            addToDockerLogs('üê≥ Starting containers...');
        }

        async function dockerPs() {
            addToDockerLogs('üìã Listing containers...');
        }

        async function dockerStop() {
            addToDockerLogs('üõë Stopping containers...');
        }

        function addToDockerLogs(text) {
            const logs = document.getElementById('dockerLogs');
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${text}`;
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
        }

        // Database Functions
        function addDatabaseConnection() {
            document.getElementById('databaseModal').classList.remove('hidden');
        }

        function closeDatabaseModal() {
            document.getElementById('databaseModal').classList.add('hidden');
        }

        async function testDatabaseConnection() {
            showNotification('üîó Testing database connection...', 'info');
            setTimeout(() => {
                showNotification('‚úÖ Connection successful', 'success');
            }, 2000);
        }

        function saveDatabaseConnection() {
            showNotification('‚úÖ Database connection saved', 'success');
            closeDatabaseModal();
        }

        function connectDatabase(connectionName) {
            showNotification(`üîó Connecting to ${connectionName}...`, 'info');
        }

        async function executeQuery() {
            const query = document.getElementById('sqlQuery').value;
            if (!query.trim()) {
                showNotification('‚ö†Ô∏è Please enter a SQL query', 'warning');
                return;
            }
            showNotification('‚ö° Executing query...', 'info');
        }

        function clearQuery() {
            document.getElementById('sqlQuery').value = '';
        }

        // GitHub Functions
        function openGitHubModal() {
            document.getElementById('githubModal').classList.remove('hidden');
        }

        function closeGitHubModal() {
            document.getElementById('githubModal').classList.add('hidden');
        }

        async function executeGitHubAction() {
            const token = document.getElementById('githubToken').value;
            const repoUrl = document.getElementById('repoUrl').value;

            if (!token || !repoUrl) {
                showNotification('‚ö†Ô∏è Please fill in all fields', 'warning');
                return;
            }

            showNotification('üêô Executing GitHub action...', 'info');
            setTimeout(() => {
                showNotification('‚úÖ GitHub integration successful', 'success');
                closeGitHubModal();
            }, 2000);
        }

        // File Operations
        function renderFileTree() {
            const container = document.getElementById('fileTree');
            container.innerHTML = '';
            renderTreeNode(fileTree, container, '');
        }

        function renderTreeNode(node, container, path) {
            for (const [name, item] of Object.entries(node)) {
                const fullPath = path ? `${path}/${name}` : name;
                
                if (item.type === 'folder') {
                    const folderDiv = document.createElement('div');
                    folderDiv.className = 'folder-item expanded';
                    folderDiv.innerHTML = `<span>üìÅ</span>${name}`;
                    
                    const childrenDiv = document.createElement('div');
                    childrenDiv.className = 'folder-children';
                    
                    folderDiv.addEventListener('click', (e) => {
                        e.stopPropagation();
                        folderDiv.classList.toggle('expanded');
                        folderDiv.classList.toggle('collapsed');
                        childrenDiv.classList.toggle('hidden');
                    });
                    
                    container.appendChild(folderDiv);
                    container.appendChild(childrenDiv);
                    
                    renderTreeNode(item.children, childrenDiv, fullPath);
                } else {
                    const fileDiv = document.createElement('div');
                    fileDiv.className = 'file-item';
                    fileDiv.innerHTML = `<span>${getFileIcon(name)}</span>${name}`;
                    fileDiv.addEventListener('click', () => openFile(fullPath));
                    container.appendChild(fileDiv);
                }
            }
        }

        function getFileIcon(fileName) {
            const ext = fileName.split('.').pop()?.toLowerCase();
            const iconMap = {
                'js': 'üìÑ', 'jsx': '‚öõÔ∏è', 'ts': 'üìò', 'tsx': '‚öõÔ∏è',
                'html': 'üåê', 'css': 'üé®', 'json': 'üìã', 'md': 'üìù',
                'php': 'üêò', 'py': 'üêç'
            };
            return iconMap[ext] || 'üìÑ';
        }

        function openFile(filePath) {
            const file = getFileFromPath(filePath);
            if (!file || file.type !== 'file') return;

            if (!openFiles.has(filePath)) {
                openFiles.set(filePath, {
                    content: file.content,
                    originalContent: file.content,
                    modified: false
                });
            }

            activeFile = filePath;
            updateTabs();
            loadFileInEditor(filePath);
            updateFileTreeSelection();
        }

        function loadFileInEditor(filePath) {
            const fileData = openFiles.get(filePath);
            if (!fileData) return;

            const language = getLanguageFromPath(filePath);
            
            document.getElementById('monaco-diff').classList.add('hidden');
            document.getElementById('monaco-editor').classList.remove('hidden');

            const model = monaco.editor.createModel(fileData.content, language);
            editor.setModel(model);
            
            document.getElementById('languageMode').textContent = language.toUpperCase();
            updateStatus(`üìñ Opened ${filePath}`);
        }

        function getLanguageFromPath(filePath) {
            const ext = filePath.split('.').pop()?.toLowerCase();
            const languageMap = {
                'js': 'javascript', 'jsx': 'javascript',
                'ts': 'typescript', 'tsx': 'typescript',
                'html': 'html', 'css': 'css',
                'json': 'json', 'md': 'markdown',
                'php': 'php', 'py': 'python'
            };
            return languageMap[ext] || 'plaintext';
        }

        function getFileFromPath(path) {
            const parts = path.split('/').filter(p => p);
            let current = fileTree;
            
            for (const part of parts) {
                if (current[part]) {
                    if (current[part].type === 'folder') {
                        current = current[part].children;
                    } else {
                        return current[part];
                    }
                } else {
                    return null;
                }
            }
            return current;
        }

        function updateTabs() {
            const container = document.getElementById('tabsContainer');
            container.innerHTML = '';

            for (const [filePath, fileData] of openFiles) {
                const tab = document.createElement('div');
                tab.className = `tab ${filePath === activeFile ? 'active' : ''}`;
                
                const fileName = filePath.split('/').pop();
                const modifiedIndicator = fileData.modified ? ' ‚óè' : '';
                
                tab.innerHTML = `
                    <span>${getFileIcon(fileName)} ${fileName}${modifiedIndicator}</span>
                    <span class="tab-close">√ó</span>
                `;
                
                tab.addEventListener('click', (e) => {
                    if (e.target.classList.contains('tab-close')) {
                        e.stopPropagation();
                        closeFile(filePath);
                    } else {
                        switchToFile(filePath);
                    }
                });
                
                container.appendChild(tab);
            }
        }

        function switchToFile(filePath) {
            activeFile = filePath;
            updateTabs();
            loadFileInEditor(filePath);
            updateFileTreeSelection();
        }

        function closeFile(filePath) {
            if (openFiles.get(filePath)?.modified) {
                if (!confirm(`File ${filePath} has unsaved changes. Close anyway?`)) {
                    return;
                }
            }

            openFiles.delete(filePath);
            
            if (activeFile === filePath) {
                const remaining = Array.from(openFiles.keys());
                if (remaining.length > 0) {
                    switchToFile(remaining[remaining.length - 1]);
                } else {
                    activeFile = null;
                    editor.setModel(null);
                }
            }
            
            updateTabs();
            updateFileTreeSelection();
        }

        function markFileAsModified(filePath) {
            const fileData = openFiles.get(filePath);
            if (fileData) {
                const currentContent = editor.getValue();
                fileData.content = currentContent;
                fileData.modified = currentContent !== fileData.originalContent;
                updateTabs();
                updateFileTreeSelection();
            }
        }

        function updateFileTreeSelection() {
            document.querySelectorAll('.file-item').forEach(item => {
                item.classList.remove('active', 'modified');
                const fileName = item.textContent.trim().split(' ').pop();
                
                if (activeFile && activeFile.endsWith(fileName)) {
                    item.classList.add('active');
                }
                
                for (const [filePath, fileData] of openFiles) {
                    if (filePath.endsWith(fileName) && fileData.modified) {
                        item.classList.add('modified');
                    }
                }
            });
        }

        // Enhanced Functions
        async function saveCurrentFile() {
            if (!activeFile) return;
            
            const content = editor.getValue();
            const fileData = openFiles.get(activeFile);
            
            if (fileData) {
                fileData.originalContent = content;
                fileData.modified = false;
                
                const file = getFileFromPath(activeFile);
                if (file) file.content = content;
                
                updateTabs();
                updateFileTreeSelection();
                updateStatus(`üíæ Saved ${activeFile}`);
                showNotification(`‚úÖ File saved: ${activeFile.split('/').pop()}`, 'success');
            }
        }

        async function saveAllFiles() {
            let savedCount = 0;
            for (const [filePath, fileData] of openFiles) {
                if (fileData.modified) {
                    fileData.originalContent = fileData.content;
                    fileData.modified = false;
                    
                    const file = getFileFromPath(filePath);
                    if (file) file.content = fileData.content;
                    savedCount++;
                }
            }
            updateTabs();
            updateFileTreeSelection();
            showNotification(`‚úÖ Saved ${savedCount} files`, 'success');
        }

        function formatDocument() {
            if (editor && activeFile) {
                editor.getAction('editor.action.formatDocument').run();
                updateStatus('üé® Document formatted');
            }
        }

        function newFile() {
            const fileName = prompt('Enter file name:', 'newfile.js');
            if (!fileName) return;

            const content = `// New file: ${fileName}\n// Created: ${new Date().toISOString()}\n\n`;
            
            fileTree[fileName] = { type: 'file', content: content };
            
            openFiles.set(fileName, {
                content: content,
                originalContent: '',
                modified: true
            });

            activeFile = fileName;
            renderFileTree();
            updateTabs();
            loadFileInEditor(fileName);
            updateStatus(`üìÑ Created ${fileName}`);
        }

        function newFolder() {
            const folderName = prompt('Enter folder name:', 'new-folder');
            if (!folderName) return;

            fileTree[folderName] = { type: 'folder', children: {} };
            renderFileTree();
            updateStatus(`üìÅ Created folder ${folderName}`);
        }

        function showDiff() {
            if (!activeFile) return;
            
            const fileData = openFiles.get(activeFile);
            if (!fileData) return;

            document.getElementById('monaco-editor').classList.add('hidden');
            document.getElementById('monaco-diff').classList.remove('hidden');

            const language = getLanguageFromPath(activeFile);
            const originalModel = monaco.editor.createModel(fileData.originalContent, language);
            const modifiedModel = monaco.editor.createModel(fileData.content, language);

            diffEditor.setModel({
                original: originalModel,
                modified: modifiedModel
            });

            updateStatus('üìã Showing diff view');
        }

        function toggleMinimap() {
            const minimap = editor.getOption(monaco.editor.EditorOption.minimap);
            editor.updateOptions({
                minimap: { enabled: !minimap.enabled }
            });
            updateStatus(`üó∫ Minimap ${minimap.enabled ? 'disabled' : 'enabled'}`);
        }

        function toggleTerminal() {
            const panel = document.getElementById('bottomPanel');
            panel.classList.toggle('hidden');
        }

        function uploadFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.onchange = (e) => {
                Array.from(e.target.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        fileTree[file.name] = {
                            type: 'file',
                            content: event.target.result
                        };
                        renderFileTree();
                        showNotification(`‚¨ÜÔ∏è Uploaded ${file.name}`, 'success');
                    };
                    reader.readAsText(file);
                });
            };
            input.click();
        }

        // Build and Run Functions
        async function buildProject() {
            switchBottomPanel('output');
            document.getElementById('bottomPanel').classList.remove('hidden');
            
            addToOutput('üî® Building project...');
            setTimeout(() => {
                addToOutput('‚úÖ Build completed successfully!');
            }, 3000);
        }

        async function runProject() {
            switchBottomPanel('output');
            document.getElementById('bottomPanel').classList.remove('hidden');
            
            addToOutput('‚ñ∂Ô∏è Starting project...');
            setTimeout(() => {
                addToOutput('üöÄ Server running on http://localhost:3000');
            }, 2000);
        }

        async function deployProject() {
            addToOutput('üöÄ Deploying project...');
            setTimeout(() => {
                addToOutput('‚úÖ Deployment successful!');
                showNotification('üöÄ Project deployed!', 'success');
            }, 2000);
        }

        // Terminal Functions
        function executeTerminalCommand(command) {
            addToTerminal(`$ ${command}`);
            
            if (command === 'help') {
                addToTerminal('Available commands: ls, pwd, git, docker, npm, help, clear');
                return;
            }
            
            if (command === 'clear') {
                document.getElementById('terminal').innerHTML = `
                    <div>üöÄ Advanced Web IDE Pro - Terminal</div>
                    <div>Connected to: <span id="terminalHost">${document.getElementById('terminalHost').textContent}</span></div>
                    <div>Type 'help' for available commands</div>
                `;
                return;
            }
            
            if (command.startsWith('git ')) {
                AdvancedAPI.executeGitCommand(command);
            } else {
                AdvancedAPI.executeRemoteCommand(command).then(result => {
                    addToTerminal(result.output);
                });
            }
        }

        function addToTerminal(text) {
            const terminal = document.getElementById('terminal');
            const div = document.createElement('div');
            div.textContent = text;
            terminal.appendChild(div);
            terminal.scrollTop = terminal.scrollHeight;
        }

        function addToOutput(text) {
            const output = document.getElementById('outputContent');
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${text}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }

        function simulateCommandOutput(command) {
            const outputs = {
                'ls': 'total 8\ndrwxr-xr-x  3 user user 4096 Sep 27 10:15 projects\n-rw-r--r--  1 user user  220 Sep 27 08:15 .bashrc',
                'pwd': currentWorkspace === 'remote' ? '/home/developer' : '/Users/developer',
                'whoami': 'developer',
                'node --version': 'v18.17.1',
                'npm --version': '9.8.1'
            };
            return outputs[command] || `Command executed: ${command}`;
        }

        function simulateGitOutput(command) {
            const outputs = {
                'git status': 'On branch main\nYour branch is up to date with \'origin/main\'.\nnothing to commit, working tree clean',
                'git pull origin main': 'Already up to date.',
                'git push origin main': 'Everything up-to-date',
                'git add .': 'Files staged for commit',
                'git fetch': 'Already up to date.'
            };
            
            for (const [key, value] of Object.entries(outputs)) {
                if (command.startsWith(key)) {
                    return value;
                }
            }
            
            return 'Git command executed successfully';
        }

        // Search Functions
        function searchInFiles(query) {
            const results = document.getElementById('searchResults');
            if (!query) {
                results.innerHTML = '';
                return;
            }

            results.innerHTML = `<div style="padding: 8px; color: #9d9d9d; font-size: 11px;">Searching for "${query}"...</div>`;
            
            setTimeout(() => {
                results.innerHTML = `
                    <div style="padding: 6px 8px; cursor: pointer; font-size: 11px;" onclick="openFile('README.md')">
                        <div style="font-weight: bold;">README.md:5</div>
                        <div style="color: #9d9d9d;">Advanced Web IDE Pro</div>
                    </div>
                `;
            }, 500);
        }

        // Utility Functions
        function updateStatus(message) {
            document.getElementById('statusMessage').textContent = message;
            setTimeout(() => {
                document.getElementById('statusMessage').textContent = 'Ready';
            }, 3000);
        }

        function showNotification(message, type = 'info') {
            document.querySelectorAll('.notification').forEach(notif => notif.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 4000);
            
            notification.addEventListener('click', () => {
                notification.remove();
            });
        }

        // Keyboard Shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 's':
                        e.preventDefault();
                        if (e.shiftKey) {
                            saveAllFiles();
                        } else {
                            saveCurrentFile();
                        }
                        break;
                    case 'n':
                        e.preventDefault();
                        newFile();
                        break;
                    case '`':
                        e.preventDefault();
                        toggleTerminal();
                        break;
                }
            }
        });

        // Expose API
        window.AdvancedCodeEditorAPI = {
            openFile: (path, content) => {
                fileTree[path] = { type: 'file', content: content };
                renderFileTree();
                openFile(path);
            },
            connectToRemote: (config) => AdvancedAPI.connectSSH(config),
            getCurrentFile: () => activeFile,
            getCurrentContent: () => editor ? editor.getValue() : '',
            showNotification: (message, type) => showNotification(message, type),
            API: AdvancedAPI
        };

        console.log('üöÄ Advanced Web IDE Pro initialized!');
        console.log('Use window.AdvancedCodeEditorAPI for external control');
    </script>
</body>
</html>