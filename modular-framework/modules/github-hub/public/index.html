<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'/>">
  <title>GitHub Hub</title>
  <link rel="stylesheet" href="./css/theme.css"/>
  <style>
    :root { --indent: 14px; }

    .wrap{display:grid;grid-template-columns:320px 1fr;gap:12px;height:100vh}
    .side{border-right:1px solid var(--line);padding:12px;overflow:auto}
    .main{padding:12px;overflow:auto}
    .file-view{
      white-space:pre; font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      border:1px solid var(--line); border-radius:6px; padding:10px; background:#111; min-height:200px
    }
    .muted{color:var(--muted); font-size:12px}

    /* SIDE MODE (embed=side) */
    .embed-side .header { display:none; }
    .embed-side .wrap { grid-template-columns: 1fr; height: 100vh; }
    .embed-side .side { border-right: none; padding: 8px; }
    .embed-side .main { display: none; }

    /* Tree */
    .tree { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size:12px }
    .tree > ul { list-style:none; margin:0; padding-left:0; }
    .tree ul ul { list-style:none; margin:0; padding-left: var(--indent); }
    .tree li { margin:0; }
    .tree .row {
      display:grid;
      grid-template-columns: 1em 1.1em 1.1em 1fr; /* twisty | checkbox | icon | name */
      align-items:center;
      gap:6px;
      padding:3px 6px;
      border-radius:6px;
    }
    .tree .row:hover { background:#222; }
    .tree .twisty { text-align:center; cursor:pointer; user-select:none; }
    .tree .icon { text-align:center; }
    .tree .name { cursor:pointer; }

    .tree .dir.collapsed > ul { display:none; }
    .tree .dir.collapsed > .row .twisty::before { content: "▸"; }
    .tree .dir.open      > .row .twisty::before { content: "▾"; }

    /* Small toolbar above the tree */
    .tree-tools { display:flex; gap:6px; margin:6px 0 8px; align-items:center; }
    .chip { font-size:11px; color:#bbb; padding:2px 6px; border:1px solid #333; border-radius:999px; }
    button.ghost{background:#2a2c31}

    .hidden { display: none; }
  </style>
  <script>
    (function () {
      const params = new URLSearchParams(location.search);
      if ((params.get('embed')||'').toLowerCase() === 'side') {
        document.documentElement.classList.add('embed-side');
      }
    })();
  </script>
</head>
<body>
  <div class="header"><strong>GitHub Hub</strong><div class="grow"></div><span class="muted">API helper for the whole framework</span></div>

  <div class="wrap">
    <div class="side">
      <h3>Repository</h3>
      <div class="connbar">
        <select id="connSelect" title="Active connection"></select>
        <button class="ghost" id="manageConnsBtn" title="Manage connections">Manage</button>
        <div class="grow"></div>
        <button class="ghost" id="openPrBtn" title="Create Pull Request">New PR</button>
      </div>
      <input type="search" id="filterInput" placeholder="Filter files (glob or /regex/)" />
      <label>Repo URL</label>
      <input id="repoUrl" placeholder="https://github.com/owner/repo" />
      <label>Branch</label>
      <select id="branchSelect"></select>
      <div class="row">
        <button id="saveCfgBtn">Save</button>
        <button class="ghost" id="testCfgBtn" title="Test connection without saving">Test</button>
        <button class="ghost" id="reloadBtn">Reload</button>
      </div>
      <details>
        <summary class="muted">Advanced</summary>
        <label>Base API URL</label>
        <input id="baseUrl" placeholder="https://api.github.com" />
        <label>PAT (repo scope)</label>
        <input id="token" placeholder="ghp_..." />
      </details>
      <div class="row" id="copyTools" style="margin-top:10px">
        <button id="copyBtn" class="ghost" title="Concatenate selected files and copy">Copy to clipboard</button>
        <span class="chip" id="tokenCountChip">0 tokens</span>
      </div>
      <div class="tree-tools">
        <button class="ghost" id="expandAllBtn">Expand all</button>
        <button class="ghost" id="collapseAllBtn">Collapse all</button>
        <span class="chip" id="selCountChip">0 selected</span>
      </div>
      <div id="tree" class="tree"></div>
    </div>
    <div class="main">
      <h3>Selected File</h3>
      <div id="fileMeta" class="muted"></div>
      <pre id="fileView" class="file-view">(select a file)</pre>
      <div class="row">
        <input id="commitMsg" placeholder="Commit message" />
        <button id="saveFileBtn">Save file</button>
      </div>
    </div>
  </div>
<div id="connModal" class="modal">
  <div class="box">
    <h3>Connections</h3>
    <h4 style="margin:6px 0 8px">Add / Edit</h4>
      <div class="grid2">
        <div>
          <label>ID</label><input id="mId" placeholder="owner-repo or any slug" />
          <label>Name (display)</label><input id="mName" placeholder="My Repo" />
          <label>Repo URL</label><input id="mRepo" placeholder="https://github.com/owner/repo" />
          <label>Default Branch</label><input id="mBranch" value="main" />
        </div>
        <div>
          <label>Base API URL</label><input id="mBase" placeholder="https://api.github.com" />
          <label>Token (PAT)</label><input id="mTok" placeholder="ghp_..." />
        </div>
      </div>
    <div id="connList" class="muted" style="margin:6px 0 10px">Loading…</div>
    <hr/>

    <div class="row">
      <button id="saveConnBtn">Save</button>
      <button class="ghost" id="testConnModalBtn">Test</button>
      <button class="ghost" id="closeConnBtn">Close</button>
    </div>
    <small class="muted">Tokens are stored encrypted if a key is configured on the server.</small>
  </div>
</div>

<div id="prModal" class="modal">
  <div class="box">
    <h3>New Pull Request</h3>
    <div class="grid2">
      <div>
        <label>Title</label><input id="prTitle" />
        <label>Base (target)</label><input id="prBase" placeholder="main" />
      </div>
      <div>
        <label>Head (source)</label><input id="prHead" placeholder="feature/my-change" />
        <label>Draft?</label>
        <select id="prDraft"><option value="false">No</option><option value="true">Yes</option></select>
      </div>
    </div>
    <label>Body (markdown)</label>
    <textarea id="prBody" rows="6"></textarea>
    <div class="row">
      <button id="createPrBtn">Create PR</button>
      <button class="ghost" id="closePrBtn">Close</button>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>
<script type="module" src="./js/app.js"></script>
</body>
</html>
